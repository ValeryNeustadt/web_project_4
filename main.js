!function(){"use strict";class e{constructor(e,t,s,r,n){this._name=e.name,this._link=e.link,this._id=e._id,this._cardOwnerId=e.owner._id,this._likes=e.likes,this._handleCardClick=t,this._handleCardDelete=s,this._handleToggleLikes=r,this._userId=n}_getTemplate(){return document.querySelector("#gallery").content.querySelector(".element").cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._element.id=this._id,this._trashButton=this._element.querySelector(".element__trash-button"),this._likeButton=this._element.querySelector(".element__button-like"),this._imageElement=this._element.querySelector(".element__photo"),this._imageText=this._element.querySelector(".element__text"),this._likeNumber=this._element.querySelector(".element__number-like"),this._imageText.textContent=this._name,this._imageElement.src=this._link,this._imageElement.alt=`Photo of ${this._link}`,this._setEventListeners(this._id),this._showTrashButton(),this._renderLikes(),this._element}_showTrashButton(){this._cardOwnerId===this._userId&&this._trashButton.classList.add("element__trash-button_visible")}_setEventListeners(){this._trashButton.addEventListener("click",(()=>{this._handleCardDelete(this._element.id)})),this._likeButton.addEventListener("click",(()=>{this._handleToggleLikes(this._element.id)})),this._imageElement.addEventListener("click",(()=>{this._handleCardClick({name:this._name,link:this._link})}))}removeElement(){this._element.remove(),this._element=null}_renderLikes(){this._likeNumber.textContent=this._likes.length||"",this.isLiked()?this._likeButton.classList.add("element__button-like_active"):this._likeButton.classList.remove("element__button-like_active")}setLikes(e){this._likes=e,this._renderLikes()}isLiked(){return this._likes.some((e=>e._id===this._userId))}}class t{constructor(e){this._popupSelector=e}open(){this._popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"==e.key&&this.close()};setEventListeners(){this._popupSelector.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s{constructor(e,t){this._formElement=t.querySelector(e.formSelector),this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showError(e){e.classList.add(this._inputErrorClass);const t=this._formElement.querySelector(`${this._inputSelector}-${e.name}-error`);t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideError(e){e.classList.remove(this._inputErrorClass);const t=this._formElement.querySelector(`${this._inputSelector}-${e.name}-error`);t.textContent="",t.classList.remove(this._errorClass)}toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_hasInvalidInput(){return this._inputs.some((e=>!e.validity.valid))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListener()}resetValidity(){this._inputs.forEach((e=>{this._hideError(e)}))}_toggleInputError(e){e.validity.valid?this._hideError(e):this._showError(e)}_setEventListener(){this._inputs=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this.toggleButtonState(),this._toggleInputError(e)}))}))}}class r{constructor(e,t){let{data:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach(this._renderer)}appendItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}}class n extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popupSelector.querySelector(".form"),this._inputList=this._popupSelector.querySelectorAll(".form__input"),this._submitButton=this._form.querySelector(".form__button"),this._submitButtonTextContent=this._submitButton.textContent}_getInputValues(){const e={};return this._inputList.forEach((t=>e[t.name]=t.value)),e}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())})),super.setEventListeners()}close(){super.close(),this._form.reset()}renderLoading(e){this._submitButton.textContent=e?"Saving...":this._submitButtonTextContent}}const i=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__avatar"),a=document.querySelector("#popup__profileform"),h=document.querySelector("#popup__addplaceform"),_=document.querySelector("#popup__updateavatar"),u=document.querySelector("#popup__confirm"),c=document.querySelector("#profileform__name"),d=document.querySelector("#profileform__about-me"),m=document.querySelector("#imagepreview"),p={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"},f=new class{constructor(e){this._url=e.baseUrl,this._token=e.token,this._headers={authorization:this._token,"Content-Type":"application/json"}}getInitialCards(){return fetch(`${this._url}/cards`,{headers:this._headers}).then(this._processServerResponse)}getUserData(){return fetch(`${this._url}/users/me`,{headers:this._headers}).then(this._processServerResponse)}addCard(e,t){return fetch(`${this._url}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._processServerResponse)}setUserData(e,t){return fetch(`${this._url}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._processServerResponse)}deleteCard(e){return fetch(`${this._url}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._processServerResponse)}addLikes(e){return fetch(`${this._url}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._processServerResponse)}deleteLikes(e){return fetch(`${this._url}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._processServerResponse)}setUserAvatar(e){return fetch(`${this._url}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._processServerResponse)}_processServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",token:"02d6028b-ac6a-4274-af91-85096bd7453f"}),g=new s(p,h),v=new s(p,_),S=new s(p,a),E=new class extends t{constructor(e){super(e),this._popupImageContent=this._popupSelector.querySelector(".popup__image-content"),this._popupImageHeader=this._popupSelector.querySelector(".popup__image-header")}_rendrePopupImagePreview(){this._popupImageContent.setAttribute("src",`${this.link}`),this._popupImageContent.setAttribute("alt",`Photo of ${this.name}`),this._popupImageHeader.textContent=this.name}open(e){this.name=e.name,this.link=e.link,super.open(),this._rendrePopupImagePreview()}}(m);E.setEventListeners();const L=new class extends t{constructor(e){super(e),this._form=this._popupSelector.querySelector(".form"),this._submitButton=this._form.querySelector(".form__button"),this._submitButtonTextContent=this._submitButton.textContent}setAction(e){this._handleFormSubmit=e}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()})),super.setEventListeners()}close(){super.close(),this._form.reset()}renderLoading(e){this._submitButton.textContent=e?"Deleting...":this._submitButtonTextContent}}(u);function b(t,s){const r=new e(t,(e=>{E.open(e)}),(e=>{L.open(),L.setAction((()=>{f.deleteCard(e).then((e=>{L.close(),r.removeElement()})).catch((e=>{console.log(`Error: ${e}`)})).finally((()=>{L.renderLoading(!1)})),L.renderLoading(!0)}))}),(e=>{r.isLiked()?f.deleteLikes(e).then((e=>{r.setLikes(e.likes)})).catch((e=>{console.log(`Error: ${e}`)})):f.addLikes(e).then((e=>{r.setLikes(e.likes)})).catch((e=>{console.log(`Error: ${e}`)}))}),s);return r.generateCard()}L.setEventListeners();const k=new class{constructor(e,t,s,r){this._profileName=document.querySelector(e),this._profileProfession=document.querySelector(t),this._image=document.querySelector(r)}getUserInfo(){return{profileName:this._profileName.textContent,profileProfession:this._profileProfession.textContent}}setUserInfo(e,t,s){this._profileName.textContent=e,this._profileProfession.textContent=t}setUserImage(e){this._image.src=e,this._image.alt=`Photo of ${this._profileName.textContent}`}}(".profile__name",".profile__profession",".profile__info",".profile__avatar-image");let y;Promise.all([f.getInitialCards(),f.getUserData()]).then((e=>{let[t,s]=e;k.setUserInfo(s.name,s.about,s._id),k.setUserImage(s.avatar),y=new r({data:t,renderer:e=>{const t=b(e,s._id);y.appendItem(t)}},".gallery__elements"),y.renderItems()})).catch((e=>{console.log(`Error: ${e}`)}));const C=new n(h,(e=>{const t={name:e.title,link:e["image-link"]};f.addCard(t.name,t.link).then((e=>{const t=b(e,e.owner._id);y.prependItem(t),C.close()})).catch((e=>{console.log(`Error: ${e}`)})).finally((()=>{C.renderLoading(!1)})),C.renderLoading(!0)})),I=new n(a,(e=>{const t=e.name,s=e["about-me"];f.setUserData(t,s).then((e=>{k.setUserInfo(e.name,e.about,e._id),I.close()})).catch((e=>{console.log(`Error: ${e}`)})).finally((()=>{I.renderLoading(!1)})),I.renderLoading(!0)})),q=new n(_,(e=>{const t=e["image-link"];f.setUserAvatar(t).then((e=>{k.setUserImage(t),q.close()})).catch((e=>{console.log(`Error: ${e}`)})).finally((()=>{q.renderLoading(!1)})),q.renderLoading(!0)}));v.enableValidation(),g.enableValidation(),S.enableValidation(),C.setEventListeners(),I.setEventListeners(),q.setEventListeners(),i.addEventListener("click",(function(){g.toggleButtonState(),g.resetValidity(),C.open()})),o.addEventListener("click",(function(){const e=k.getUserInfo();c.value=e.profileName,d.value=e.profileProfession,S.toggleButtonState(),S.resetValidity(),I.open()})),l.addEventListener("click",(function(){v.toggleButtonState(),v.resetValidity(),q.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEJtRixFQUFxQm5GLG1CQUNyQnFILEVBQWNySixvQkFDZHdKLEVBQWF4SixvQkFDYnlKLEVBQWtCekosb0JBdUJsQnFFLEVBQWlCdkYsaUJBQWlCLFNBckJsQyxXQUNFbUksRUFBc0J4RixvQkFDdEJ3RixFQUFzQjdFLGdCQUN0QmlILEVBQWMzSixNQUNoQixJQWtCQTRFLEVBQWtCeEYsaUJBQWlCLFNBaEJuQyxXQUNFLE1BQU1xSyxFQUFXZixFQUFTUSxjQUMxQmhFLEVBQVVYLE1BQVFrRixFQUFTZCxZQUMzQnhELEVBQWFaLE1BQVFrRixFQUFTYixrQkFDOUJuQixFQUFxQjFGLG9CQUNyQjBGLEVBQXFCL0UsZ0JBQ3JCb0gsRUFBYTlKLE1BQ2YsSUFVQTZFLEVBQWlCekYsaUJBQWlCLFNBUmxDLFdBQ0VvSSxFQUFvQnpGLG9CQUNwQnlGLEVBQW9COUUsZ0JBQ3BCcUgsRUFBa0IvSixNQUNwQixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9wcmFjdGljdW0vLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwQ29uZmlybURlbGV0ZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGRhdGEsXG4gICAgaGFuZGxlQ2FyZENsaWNrLFxuICAgIGhhbmRsZUNhcmREZWxldGUsXG4gICAgaGFuZGxlVG9nZ2xlTGlrZXMsXG4gICAgdXNlcklkXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICAgIHRoaXMuX2NhcmRPd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZTtcbiAgICB0aGlzLl9oYW5kbGVUb2dnbGVMaWtlcyA9IGhhbmRsZVRvZ2dsZUxpa2VzO1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICBjb25zdCBnYWxsZXJ5RWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNnYWxsZXJ5XCIpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgcmV0dXJuIGdhbGxlcnlFbGVtZW50O1xuICB9XG5cbiAgZ2VuZXJhdGVDYXJkKCkge1xuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMuX2VsZW1lbnQuaWQgPSB0aGlzLl9pZDtcbiAgICB0aGlzLl90cmFzaEJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X190cmFzaC1idXR0b25cIik7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19idXR0b24tbGlrZVwiKTtcbiAgICB0aGlzLl9pbWFnZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fcGhvdG9cIik7XG4gICAgdGhpcy5faW1hZ2VUZXh0ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX3RleHRcIik7XG4gICAgdGhpcy5fbGlrZU51bWJlciA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19udW1iZXItbGlrZVwiKTtcbiAgICB0aGlzLl9pbWFnZVRleHQudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hbHQgPSBgUGhvdG8gb2YgJHt0aGlzLl9saW5rfWA7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnModGhpcy5faWQpO1xuICAgIHRoaXMuX3Nob3dUcmFzaEJ1dHRvbigpO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gIH1cblxuICBfc2hvd1RyYXNoQnV0dG9uKCkge1xuICAgIGlmICh0aGlzLl9jYXJkT3duZXJJZCA9PT0gdGhpcy5fdXNlcklkKSB7XG4gICAgICB0aGlzLl90cmFzaEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWxlbWVudF9fdHJhc2gtYnV0dG9uX3Zpc2libGVcIik7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3RyYXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlKHRoaXMuX2VsZW1lbnQuaWQpO1xuICAgIH0pO1xuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZVRvZ2dsZUxpa2VzKHRoaXMuX2VsZW1lbnQuaWQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBuYW1lOiB0aGlzLl9uYW1lLCBsaW5rOiB0aGlzLl9saW5rIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlRWxlbWVudCgpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgX3JlbmRlckxpa2VzKCkge1xuICAgIHRoaXMuX2xpa2VOdW1iZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGggfHwgXCJcIjtcbiAgICBpZiAodGhpcy5pc0xpa2VkKCkpIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImVsZW1lbnRfX2J1dHRvbi1saWtlX2FjdGl2ZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiZWxlbWVudF9fYnV0dG9uLWxpa2VfYWN0aXZlXCIpO1xuICAgIH1cbiAgfVxuXG4gIHNldExpa2VzKG5ld0xpa2VzKSB7XG4gICAgdGhpcy5fbGlrZXMgPSBuZXdMaWtlcztcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xuICB9XG5cbiAgaXNMaWtlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZSgocGVyc29uKSA9PiBwZXJzb24uX2lkID09PSB0aGlzLl91c2VySWQpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cFNlbGVjdG9yID0gcG9wdXBTZWxlY3RvcjtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwU2VsZWN0b3IuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cblxuICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC5rZXkgPT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cFNlbGVjdG9yLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZS1idXR0b25cIilcbiAgICAgICkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBGb3JtVmFsaWRhdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRpb25QYXJhbXMsIGZvcm0pIHtcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm0ucXVlcnlTZWxlY3Rvcih2YWxpZGF0aW9uUGFyYW1zLmZvcm1TZWxlY3Rvcik7IC8vIFwiI3BvcHVwX19hZGRwbGFjZWZvcm1cIiBvciBcIiNwb3B1cF9fcHJvZmlsZWZvcm1cIlxuICAgIHRoaXMuX2Zvcm1TZWxlY3RvciA9IHZhbGlkYXRpb25QYXJhbXMuZm9ybVNlbGVjdG9yOyAvL1wiLnBvcHVwX19mb3JtXCIsXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHZhbGlkYXRpb25QYXJhbXMuaW5wdXRTZWxlY3RvcjsgLy9cIi5mb3JtX19pbnB1dFwiLFxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gdmFsaWRhdGlvblBhcmFtcy5zdWJtaXRCdXR0b25TZWxlY3RvcjsgLy9cIi5mb3JtX19idXR0b25cIixcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gdmFsaWRhdGlvblBhcmFtcy5pbmFjdGl2ZUJ1dHRvbkNsYXNzOyAvL1wiZm9ybV9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gdmFsaWRhdGlvblBhcmFtcy5pbnB1dEVycm9yQ2xhc3M7IC8vXCJmb3JtX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHZhbGlkYXRpb25QYXJhbXMuZXJyb3JDbGFzczsgLy9cImZvcm1fX2Vycm9yX3Zpc2libGVcIixcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuXG4gIF9zaG93RXJyb3IoaW5wdXRJdGVtKSB7XG4gICAgaW5wdXRJdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCR7dGhpcy5faW5wdXRTZWxlY3Rvcn0tJHtpbnB1dEl0ZW0ubmFtZX0tZXJyb3JgXG4gICAgKTtcbiAgICBlcnJvck1lc3NhZ2UudGV4dENvbnRlbnQgPSBpbnB1dEl0ZW0udmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfaGlkZUVycm9yKGlucHV0SXRlbSkge1xuICAgIGlucHV0SXRlbS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAke3RoaXMuX2lucHV0U2VsZWN0b3J9LSR7aW5wdXRJdGVtLm5hbWV9LWVycm9yYFxuICAgICk7XG4gICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBlcnJvck1lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dHMuc29tZSgoaW5wdXQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVyKCk7XG4gIH1cblxuICByZXNldFZhbGlkaXR5KCkge1xuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dEl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX2hpZGVFcnJvcihpbnB1dEl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgX3RvZ2dsZUlucHV0RXJyb3IoaW5wdXRJdGVtKSB7XG4gICAgaWYgKGlucHV0SXRlbS52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5faGlkZUVycm9yKGlucHV0SXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dFcnJvcihpbnB1dEl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVyKCkge1xuICAgIHRoaXMuX2lucHV0cyA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXRJdGVtKSA9PiB7XG4gICAgICBpbnB1dEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgICB0aGlzLl90b2dnbGVJbnB1dEVycm9yKGlucHV0SXRlbSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGRhdGEsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5faXRlbXMgPSBkYXRhO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcygpIHtcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKHRoaXMuX3JlbmRlcmVyKTtcbiAgfVxuXG4gIGFwcGVuZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7XG4gIH1cbiAgcHJlcGVuZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXAuanNcIjtcbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IHRoaXMuX3BvcHVwU2VsZWN0b3IucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtX19pbnB1dFwiKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fYnV0dG9uXCIpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblRleHRDb250ZW50ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGZvcm1WYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IChmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWUpKTtcbiAgICByZXR1cm4gZm9ybVZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIHRoaXMucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9zdWJtaXRCdXR0b25UZXh0Q29udGVudDtcbiAgICB9XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBwcm9maWxlQWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIlxuKTtcblxuZXhwb3J0IGNvbnN0IGF2YXRhckVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVJbmZvU2VsZWN0b3IgPSBcIi5wcm9maWxlX19pbmZvXCI7XG5leHBvcnQgY29uc3QgdXNlckltYWdlU2VsZWN0b3IgPSBcIi5wcm9maWxlX19hdmF0YXItaW1hZ2VcIjtcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IFwiLnByb2ZpbGVfX25hbWVcIjtcbmV4cG9ydCBjb25zdCBwcm9maWxlUHJvZmVzc2lvbiA9IFwiLnByb2ZpbGVfX3Byb2Zlc3Npb25cIjtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9fcHJvZmlsZWZvcm1cIik7XG5leHBvcnQgY29uc3QgYWRkUGxhY2VGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9fYWRkcGxhY2Vmb3JtXCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwX191cGRhdGVhdmF0YXJcIik7XG5cbmV4cG9ydCBjb25zdCBjb25maXJtUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwX19jb25maXJtXCIpO1xuXG5leHBvcnQgY29uc3QgaW5wdXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlZm9ybV9fbmFtZVwiKTtcbmV4cG9ydCBjb25zdCBpbnB1dEFib3V0bWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVmb3JtX19hYm91dC1tZVwiKTtcblxuZXhwb3J0IGNvbnN0IGltYWdlUHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2VwcmV2aWV3XCIpO1xuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25QYXJhbXMgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIuZm9ybV9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmZvcm1fX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImZvcm1fX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcImZvcm1fX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmV4cG9ydCBjb25zdCBjYXJkTGlzdFNlY3Rpb24gPSBcIi5nYWxsZXJ5X19lbGVtZW50c1wiO1xuXG5leHBvcnQgY29uc3QgZ2FsbGVyeUNhcmRzSW5wdXRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFrZS1sb3Vpc2UuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS92YW5vaXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYWdvIGRpIEJyYWllc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIixcbiAgfSxcbl07XG4iLCJpbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcblxuLy9UaGUgbGlrZSBidXR0b24gc2hvdWxkIG5vdCBtb3ZlIHRvIHRvcCB3aGVuIHRoZSB0ZXh0IGFwcGVhcnMuIFBsZWFzZSB0YWtlIGEgbG9vayBhdCB0aGUgZGVzaWduXG4vL0knbSBzb3JyeSwgYnV0IEkgZG9uJ3QgdW5kZXJzdGFuZCB0aGlzIHBvaW50LlxuLy9JIGNvdWxkbid0IGZpbmQgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBoYXBwZW5zIHdoZW4gdGhlIG51bWJlciBvZiBsaWtlcyBpcyB6ZXJvLlxuLy9JbiB0aGUgcHJldmlvdXMgc3ByaW50LCB0aGUgXCJMaWtlXCIgYnV0dG9uIHdhcyBvbiB0aGUgc2FtZSBsZXZlbCBhcyB0aGUgbmFtZSBvZiB0aGUgcGxhY2UuXG4vL0ZvciBtZSwgdGhpcyBtZWFucyB0aGF0IHdoZW4gYSBudW1iZXIgY2hhbmdlcyBmcm9tIHplcm8gdG8gb25lLFxuLy9pdCBzaG91bGQgbW92ZSB1cCBhbmQgZnJlZSB1cCBzcGFjZSBmb3IgdGhlIGNvdW50ZXIuXG5cbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgeyBQb3B1cENvbmZpcm1EZWxldGUgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cENvbmZpcm1EZWxldGUuanNcIjtcbmltcG9ydCB7IEZvcm1WYWxpZGF0aW9uIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IHsgU2VjdGlvbiB9IGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCB7IFBvcHVwV2l0aEZvcm0gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XG5pbXBvcnQgeyBVc2VySW5mbyB9IGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuaW1wb3J0IHtcbiAgcHJvZmlsZUFkZEJ1dHRvbixcbiAgcHJvZmlsZUVkaXRCdXR0b24sXG4gIGF2YXRhckVkaXRCdXR0b24sXG4gIHByb2ZpbGVOYW1lLFxuICBwcm9maWxlUHJvZmVzc2lvbixcbiAgcHJvZmlsZUZvcm0sXG4gIGFkZFBsYWNlRm9ybSxcbiAgYXZhdGFyRm9ybSxcbiAgaW5wdXROYW1lLFxuICBpbnB1dEFib3V0bWUsXG4gIGltYWdlUHJldmlldyxcbiAgdmFsaWRhdGlvblBhcmFtcyxcbiAgY2FyZExpc3RTZWN0aW9uLFxuICBjb25maXJtUG9wdXAsXG4gIHByb2ZpbGVJbmZvU2VsZWN0b3IsXG4gIHVzZXJJbWFnZVNlbGVjdG9yLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcbiAgdG9rZW46IFwiMDJkNjAyOGItYWM2YS00Mjc0LWFmOTEtODUwOTZiZDc0NTNmXCIsXG59KTtcblxuY29uc3QgYWRkUGxhY2VGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0aW9uKFxuICB2YWxpZGF0aW9uUGFyYW1zLFxuICBhZGRQbGFjZUZvcm1cbik7XG5cbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRpb24odmFsaWRhdGlvblBhcmFtcywgYXZhdGFyRm9ybSk7XG5cbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0aW9uKHZhbGlkYXRpb25QYXJhbXMsIHByb2ZpbGVGb3JtKTtcblxuY29uc3QgcG9wdXBXaXRoSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoaW1hZ2VQcmV2aWV3KTtcbnBvcHVwV2l0aEltYWdlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGNvbmZpcm1EZWxldGVQb3B1cCA9IG5ldyBQb3B1cENvbmZpcm1EZWxldGUoY29uZmlybVBvcHVwKTtcbmNvbmZpcm1EZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGRhdGEsIHVzZXJJZCkge1xuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXG4gICAgZGF0YSxcbiAgICAoaW1hZ2VEYXRhKSA9PiB7XG4gICAgICBwb3B1cFdpdGhJbWFnZS5vcGVuKGltYWdlRGF0YSk7XG4gICAgfSxcbiAgICAoY2FyZElkKSA9PiB7XG4gICAgICBjb25maXJtRGVsZXRlUG9wdXAub3BlbigpO1xuICAgICAgY29uZmlybURlbGV0ZVBvcHVwLnNldEFjdGlvbigoKSA9PiB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5kZWxldGVDYXJkKGNhcmRJZClcbiAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICBjb25maXJtRGVsZXRlUG9wdXAuY2xvc2UoKTtcbiAgICAgICAgICAgIGNhcmQucmVtb3ZlRWxlbWVudCgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICBjb25maXJtRGVsZXRlUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uZmlybURlbGV0ZVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIChjYXJkSWQpID0+IHtcbiAgICAgIGNvbnN0IGNoZWNrTGlrZWQgPSBjYXJkLmlzTGlrZWQoKTtcbiAgICAgIGlmIChjaGVja0xpa2VkKSB7XG4gICAgICAgIGFwaVxuICAgICAgICAgIC5kZWxldGVMaWtlcyhjYXJkSWQpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZC5zZXRMaWtlcyhyZXMubGlrZXMpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcGlcbiAgICAgICAgICAuYWRkTGlrZXMoY2FyZElkKVxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgIGNhcmQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgdXNlcklkXG4gICk7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhcbiAgcHJvZmlsZU5hbWUsXG4gIHByb2ZpbGVQcm9mZXNzaW9uLFxuICBwcm9maWxlSW5mb1NlbGVjdG9yLFxuICB1c2VySW1hZ2VTZWxlY3RvclxuKTtcblxubGV0IGNhcmRTZWN0aW9uO1xuXG5Qcm9taXNlLmFsbChbYXBpLmdldEluaXRpYWxDYXJkcygpLCBhcGkuZ2V0VXNlckRhdGEoKV0pXG4gIC50aGVuKChbY2FyZHMsIHVzZXJEYXRhXSkgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhLm5hbWUsIHVzZXJEYXRhLmFib3V0LCB1c2VyRGF0YS5faWQpO1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbWFnZSh1c2VyRGF0YS5hdmF0YXIpO1xuICAgIGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gICAgICB7XG4gICAgICAgIGRhdGE6IGNhcmRzLFxuICAgICAgICByZW5kZXJlcjogKGRhdGEpID0+IHtcbiAgICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IHJlbmRlckNhcmQoZGF0YSwgdXNlckRhdGEuX2lkKTtcbiAgICAgICAgICBjYXJkU2VjdGlvbi5hcHBlbmRJdGVtKGNhcmRFbGVtZW50KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBjYXJkTGlzdFNlY3Rpb25cbiAgICApO1xuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycn1gKTtcbiAgfSk7XG5cbmNvbnN0IGFkZFBsYWNlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShhZGRQbGFjZUZvcm0sIChkYXRhKSA9PiB7XG4gIGNvbnN0IGNhcmREYXRhID0ge1xuICAgIG5hbWU6IGRhdGFbXCJ0aXRsZVwiXSxcbiAgICBsaW5rOiBkYXRhW1wiaW1hZ2UtbGlua1wiXSxcbiAgfTtcbiAgYXBpXG4gICAgLmFkZENhcmQoY2FyZERhdGEubmFtZSwgY2FyZERhdGEubGluaylcbiAgICAudGhlbigocG9zdCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSByZW5kZXJDYXJkKHBvc3QsIHBvc3Qub3duZXIuX2lkKTtcbiAgICAgIGNhcmRTZWN0aW9uLnByZXBlbmRJdGVtKGNhcmRFbGVtZW50KTtcbiAgICAgIGFkZFBsYWNlUG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xuICAgICAgLy8gYWRkUGxhY2VQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGFkZFBsYWNlUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG4gIGFkZFBsYWNlUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcbn0pO1xuXG5jb25zdCBwcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShwcm9maWxlRm9ybSwgKGRhdGEpID0+IHtcbiAgY29uc3QgaW5wdXROYW1lID0gZGF0YVtcIm5hbWVcIl07XG4gIGNvbnN0IGlucHV0QWJvdXRNZSA9IGRhdGFbXCJhYm91dC1tZVwiXTtcbiAgYXBpXG4gICAgLnNldFVzZXJEYXRhKGlucHV0TmFtZSwgaW5wdXRBYm91dE1lKVxuICAgIC50aGVuKChwb3N0KSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhwb3N0Lm5hbWUsIHBvc3QuYWJvdXQsIHBvc3QuX2lkKTtcbiAgICAgIHByb2ZpbGVQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gICAgICAvLyBwcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG4gIHByb2ZpbGVQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xufSk7XG5cbmNvbnN0IHVwZGF0ZUF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oYXZhdGFyRm9ybSwgKGRhdGEpID0+IHtcbiAgY29uc3QgaW1hZ2VMaW5rID0gZGF0YVtcImltYWdlLWxpbmtcIl07XG4gIGFwaVxuICAgIC5zZXRVc2VyQXZhdGFyKGltYWdlTGluaylcbiAgICAudGhlbigocG9zdCkgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckltYWdlKGltYWdlTGluayk7XG4gICAgICB1cGRhdGVBdmF0YXJQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gICAgICAvLyB1cGRhdGVBdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHVwZGF0ZUF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xuICB1cGRhdGVBdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xufSk7XG5cbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuYWRkUGxhY2VGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbnByb2ZpbGVGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbmFkZFBsYWNlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbnByb2ZpbGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xudXBkYXRlQXZhdGFyUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEJ1dHRvbkNsaWNrKCkge1xuICBhZGRQbGFjZUZvcm1WYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgYWRkUGxhY2VGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRpdHkoKTtcbiAgYWRkUGxhY2VQb3B1cC5vcGVuKCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRQcm9maWxlQnV0dG9uQ2xpY2soKSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgaW5wdXROYW1lLnZhbHVlID0gdXNlckRhdGEucHJvZmlsZU5hbWU7XG4gIGlucHV0QWJvdXRtZS52YWx1ZSA9IHVzZXJEYXRhLnByb2ZpbGVQcm9mZXNzaW9uO1xuICBwcm9maWxlRm9ybVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xuICBwcm9maWxlRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkaXR5KCk7XG4gIHByb2ZpbGVQb3B1cC5vcGVuKCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRBdmF0YXJCdXR0b25DbGljaygpIHtcbiAgYXZhdGFyRm9ybVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xuICBhdmF0YXJGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRpdHkoKTtcbiAgdXBkYXRlQXZhdGFyUG9wdXAub3BlbigpO1xufVxuXG5wcm9maWxlQWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVBZGRDYXJkQnV0dG9uQ2xpY2spO1xucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUVkaXRQcm9maWxlQnV0dG9uQ2xpY2spO1xuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlRWRpdEF2YXRhckJ1dHRvbkNsaWNrKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLl91cmwgPSBvcHRpb25zLmJhc2VVcmw7XG4gICAgdGhpcy5fdG9rZW4gPSBvcHRpb25zLnRva2VuO1xuICAgIHRoaXMuX2hlYWRlcnMgPSB7XG4gICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH07XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX3VybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fcHJvY2Vzc1NlcnZlclJlc3BvbnNlKTtcbiAgfVxuXG4gIGdldFVzZXJEYXRhKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBhZGRDYXJkKG5hbWUsIGxpbmspIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBsaW5rOiBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9wcm9jZXNzU2VydmVyUmVzcG9uc2UpO1xuICB9XG5cbiAgc2V0VXNlckRhdGEoaW5wdXROYW1lLCBpbnB1dEFib3V0TWUpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogaW5wdXROYW1lLFxuICAgICAgICBhYm91dDogaW5wdXRBYm91dE1lLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9wcm9jZXNzU2VydmVyUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fcHJvY2Vzc1NlcnZlclJlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZExpa2VzKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9wcm9jZXNzU2VydmVyUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlTGlrZXMoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX3VybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBzZXRVc2VyQXZhdGFyKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyOiBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBfcHJvY2Vzc1NlcnZlclJlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cC5qc1wiO1xuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fcG9wdXBJbWFnZUNvbnRlbnQgPSB0aGlzLl9wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5wb3B1cF9faW1hZ2UtY29udGVudFwiXG4gICAgKTtcbiAgICB0aGlzLl9wb3B1cEltYWdlSGVhZGVyID0gdGhpcy5fcG9wdXBTZWxlY3Rvci5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIucG9wdXBfX2ltYWdlLWhlYWRlclwiXG4gICAgKTtcbiAgfVxuXG4gIF9yZW5kcmVQb3B1cEltYWdlUHJldmlldygpIHtcbiAgICB0aGlzLl9wb3B1cEltYWdlQ29udGVudC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgYCR7dGhpcy5saW5rfWApO1xuICAgIHRoaXMuX3BvcHVwSW1hZ2VDb250ZW50LnNldEF0dHJpYnV0ZShcImFsdFwiLCBgUGhvdG8gb2YgJHt0aGlzLm5hbWV9YCk7XG4gICAgdGhpcy5fcG9wdXBJbWFnZUhlYWRlci50ZXh0Q29udGVudCA9IHRoaXMubmFtZTtcbiAgfVxuXG4gIG9wZW4oZGF0YSkge1xuICAgIHRoaXMubmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLmxpbmsgPSBkYXRhLmxpbms7XG4gICAgc3VwZXIub3BlbigpO1xuICAgIHRoaXMuX3JlbmRyZVBvcHVwSW1hZ2VQcmV2aWV3KCk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cC5qc1wiO1xuZXhwb3J0IGNsYXNzIFBvcHVwQ29uZmlybURlbGV0ZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fYnV0dG9uXCIpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblRleHRDb250ZW50ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICB9XG5cbiAgc2V0QWN0aW9uKGFjdGlvbikge1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBhY3Rpb247XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy90aGlzLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KCk7XG4gICAgICAvL3N1cGVyLmNsb3NlKCk7XG4gICAgfSk7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIkRlbGV0aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ1dHRvblRleHRDb250ZW50O1xuICAgIH1cbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJvZmlsZU5hbWUsXG4gICAgcHJvZmlsZVByb2Zlc3Npb24sXG4gICAgcHJvZmlsZUluZm9TZWxlY3RvcixcbiAgICB1c2VySW1hZ2VTZWxlY3RvclxuICApIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmlsZU5hbWUpO1xuICAgIHRoaXMuX3Byb2ZpbGVQcm9mZXNzaW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwcm9maWxlUHJvZmVzc2lvbik7XG4gICAgLy90aGlzLl9pZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmlsZUluZm9TZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJJbWFnZVNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIGNvbnN0IHVzZXJWYWx1ZXMgPSB7XG4gICAgICBwcm9maWxlTmFtZTogdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQsXG4gICAgICBwcm9maWxlUHJvZmVzc2lvbjogdGhpcy5fcHJvZmlsZVByb2Zlc3Npb24udGV4dENvbnRlbnQsXG4gICAgfTtcbiAgICByZXR1cm4gdXNlclZhbHVlcztcbiAgfVxuXG4gIHNldFVzZXJJbmZvKGlucHV0TmFtZSwgaW5wdXRBYm91dE1lLCBpZCkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gaW5wdXROYW1lO1xuICAgIHRoaXMuX3Byb2ZpbGVQcm9mZXNzaW9uLnRleHRDb250ZW50ID0gaW5wdXRBYm91dE1lO1xuICAgIC8vdGhpcy5faWQuaWQgPSBpZDtcbiAgfVxuXG4gIHNldFVzZXJJbWFnZShpbWFnZUxpbmspIHtcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBpbWFnZUxpbms7XG4gICAgdGhpcy5faW1hZ2UuYWx0ID0gYFBob3RvIG9mICR7dGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnR9YDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVDYXJkRGVsZXRlIiwiaGFuZGxlVG9nZ2xlTGlrZXMiLCJ1c2VySWQiLCJ0aGlzIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2lkIiwiX2NhcmRPd25lcklkIiwib3duZXIiLCJfbGlrZXMiLCJsaWtlcyIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9oYW5kbGVUb2dnbGVMaWtlcyIsIl91c2VySWQiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiX2VsZW1lbnQiLCJpZCIsIl90cmFzaEJ1dHRvbiIsIl9saWtlQnV0dG9uIiwiX2ltYWdlRWxlbWVudCIsIl9pbWFnZVRleHQiLCJfbGlrZU51bWJlciIsInRleHRDb250ZW50Iiwic3JjIiwiYWx0IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX3Nob3dUcmFzaEJ1dHRvbiIsIl9yZW5kZXJMaWtlcyIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFbGVtZW50IiwicmVtb3ZlIiwibGVuZ3RoIiwiaXNMaWtlZCIsInNldExpa2VzIiwibmV3TGlrZXMiLCJzb21lIiwicGVyc29uIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwU2VsZWN0b3IiLCJvcGVuIiwiX2hhbmRsZUVzY0Nsb3NlIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIkZvcm1WYWxpZGF0aW9uIiwidmFsaWRhdGlvblBhcmFtcyIsImZvcm0iLCJfZm9ybUVsZW1lbnQiLCJmb3JtU2VsZWN0b3IiLCJfZm9ybVNlbGVjdG9yIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2J1dHRvbkVsZW1lbnQiLCJfc2hvd0Vycm9yIiwiaW5wdXRJdGVtIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUVycm9yIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJfaW5wdXRzIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiZW5hYmxlVmFsaWRhdGlvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIl9zZXRFdmVudExpc3RlbmVyIiwicmVzZXRWYWxpZGl0eSIsImZvckVhY2giLCJfdG9nZ2xlSW5wdXRFcnJvciIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJTZWN0aW9uIiwiX3JlZiIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJhcHBlbmRJdGVtIiwiZWxlbWVudCIsImFwcGVuZCIsInByZXBlbmRJdGVtIiwicHJlcGVuZCIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9mb3JtIiwiX2lucHV0TGlzdCIsIl9zdWJtaXRCdXR0b24iLCJfc3VibWl0QnV0dG9uVGV4dENvbnRlbnQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJmb3JtVmFsdWVzIiwidmFsdWUiLCJyZXNldCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJwcm9maWxlQWRkQnV0dG9uIiwicHJvZmlsZUVkaXRCdXR0b24iLCJhdmF0YXJFZGl0QnV0dG9uIiwicHJvZmlsZUZvcm0iLCJhZGRQbGFjZUZvcm0iLCJhdmF0YXJGb3JtIiwiY29uZmlybVBvcHVwIiwiaW5wdXROYW1lIiwiaW5wdXRBYm91dG1lIiwiaW1hZ2VQcmV2aWV3IiwiYXBpIiwib3B0aW9ucyIsIl91cmwiLCJiYXNlVXJsIiwiX3Rva2VuIiwidG9rZW4iLCJfaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsImhlYWRlcnMiLCJ0aGVuIiwiX3Byb2Nlc3NTZXJ2ZXJSZXNwb25zZSIsImdldFVzZXJEYXRhIiwiYWRkQ2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0VXNlckRhdGEiLCJpbnB1dEFib3V0TWUiLCJhYm91dCIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJhZGRMaWtlcyIsImRlbGV0ZUxpa2VzIiwic2V0VXNlckF2YXRhciIsImF2YXRhciIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJhZGRQbGFjZUZvcm1WYWxpZGF0b3IiLCJhdmF0YXJGb3JtVmFsaWRhdG9yIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJwb3B1cFdpdGhJbWFnZSIsIl9wb3B1cEltYWdlQ29udGVudCIsIl9wb3B1cEltYWdlSGVhZGVyIiwiX3JlbmRyZVBvcHVwSW1hZ2VQcmV2aWV3Iiwic2V0QXR0cmlidXRlIiwiY29uZmlybURlbGV0ZVBvcHVwIiwic2V0QWN0aW9uIiwiYWN0aW9uIiwicmVuZGVyQ2FyZCIsImNhcmQiLCJpbWFnZURhdGEiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJmaW5hbGx5IiwidXNlckluZm8iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVQcm9mZXNzaW9uIiwicHJvZmlsZUluZm9TZWxlY3RvciIsInVzZXJJbWFnZVNlbGVjdG9yIiwiX3Byb2ZpbGVOYW1lIiwiX3Byb2ZpbGVQcm9mZXNzaW9uIiwiX2ltYWdlIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsInNldFVzZXJJbWFnZSIsImltYWdlTGluayIsImNhcmRTZWN0aW9uIiwiYWxsIiwiY2FyZHMiLCJ1c2VyRGF0YSIsImNhcmRFbGVtZW50IiwiYWRkUGxhY2VQb3B1cCIsImNhcmREYXRhIiwicG9zdCIsInByb2ZpbGVQb3B1cCIsInVwZGF0ZUF2YXRhclBvcHVwIl0sInNvdXJjZVJvb3QiOiIifQ==